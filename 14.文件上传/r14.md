# 文件上传
通过 PHP，可以把文件上传到服务器。      

# 原理
文件从用户本地电脑通过传输方式（web表单）保存到服务器所在电脑指定的目录下
![alt text](image.png)

# html中用来文件上传的表单
```php
<form action="upload.php" method="post" enctype="multipart/form-data">
<label for="file">上传文件：</label>
<input type="file" name="file" id="file" /> 
<br />
<input type="submit" name="submit" value="上传" />
</form>
//<form>标签的 enctype 属性规定了在提交表单时要使用哪种内容类型。在表单需要二进制数据时，比如文件内容，请使用 “multipart/form-data”
//<input> 标签的 type=“file” 属性规定了应该把输入作为文件来处理。举例来说，当在浏览器中预览时，会看到输入框旁边有一个浏览按钮

//允许用户上传文件是一个巨大的安全风险。请仅仅允许可信的用户执行文件上传操作
```

# php中接收接表单上传文件的脚本
```php
<?php
if ($_FILES["file"]["error"] > 0)
  {
  echo "Error: " . $_FILES["file"]["error"] . "<br />";
  }
else
  {
  echo "Upload: " . $_FILES["file"]["name"] . "<br />";
  echo "Type: " . $_FILES["file"]["type"] . "<br />";
  echo "Size: " . ($_FILES["file"]["size"] / 1024) . " Kb<br />";
  echo "Stored in: " . $_FILES["file"]["tmp_name"];
  }
?>
//全局数组$_FILES, 可以从客户端向服务器上传文件
//第一个参数是表单输入name
//第二个参数是类型 name , type , size(字节), tmp_name存储在服务器的文件的临时副本的名称
//$_FILES["file"]["error"]文件上传导致的错误代码
```

# 定义上传文件的限制
如下用户只能上传 .gif 或 .jpeg 文件：   
```php
<?php

if ((($_FILES["file"]["type"] == "image/gif")
|| ($_FILES["file"]["type"] == "image/jpeg")
|| ($_FILES["file"]["type"] == "image/pjpeg"))
//.gif , .jpeg, .pjpeg
&& ($_FILES["file"]["size"] < 20000))
//字节<20000
  {
  if ($_FILES["file"]["error"] > 0)
    {
    echo "Error: " . $_FILES["file"]["error"] . "<br />";
    }
  else
    {
    echo "Upload: " . $_FILES["file"]["name"] . "<br />";
    echo "Type: " . $_FILES["file"]["type"] . "<br />";
    echo "Size: " . ($_FILES["file"]["size"] / 1024) . " Kb<br />";
    echo "Stored in: " . $_FILES["file"]["tmp_name"];
    }
  }
else
  {
  echo "Invalid file"; //无效
  }

?>
```

# 保存被上传的文件  move_uploaded_file()
将上传的文件移动到新位置    上传到服务器的只是临时文件，所以需要移动到相应文件目录来保存。  
```php
move_uploaded_file(file,newloc)
//file ：必需，规定要移动的文件路径
//newloc ： 必需，规定文件的新位置

// php用来另存临时文件的代码示例
<?php
if ((($_FILES["file"]["type"] == "image/gif")
|| ($_FILES["file"]["type"] == "image/jpeg")
|| ($_FILES["file"]["type"] == "image/pjpeg"))
&& ($_FILES["file"]["size"] < 20000))
  {
  if ($_FILES["file"]["error"] > 0)
    {
    echo "Return Code: " . $_FILES["file"]["error"] . "<br />";
    }
  else
    {
    echo "Upload: " . $_FILES["file"]["name"] . "<br />";
    echo "Type: " . $_FILES["file"]["type"] . "<br />";
    echo "Size: " . ($_FILES["file"]["size"] / 1024) . " Kb<br />";
    echo "Temp file: " . $_FILES["file"]["tmp_name"] . "<br />";

    if (file_exists("upload/" . $_FILES["file"]["name"]))
    //如果存在upload文件夹
      {
      echo $_FILES["file"]["name"] . " already exists. ";
      }
    else
      {
      move_uploaded_file($_FILES["file"]["tmp_name"],
      //否则将文件移动到新位置tmp_name
      "upload/" . $_FILES["file"]["name"]);
      echo "Stored in: " . "upload/" . $_FILES["file"]["name"];
      }
    }
  }
else
  {
  echo "Invalid file";
  }
?>
```